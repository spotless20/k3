[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[include mainsail.cfg]
[include timelapse.cfg]
[include printerfiles/caselight.cfg]
[include printerfiles/command.cfg]
[include printerfiles/extruder.cfg]
[include printerfiles/octo_xyz.cfg]
[include printerfiles/thermfans.cfg]
[include printerfiles/heater.cfg]
[include printerfiles/makros.cfg]
[include printerfiles/makroscustom.cfg]

#[include K-ShakeTune/*.cfg]

#[include external/nevermore.cfg]
#[include external/tradrack.cfg]
#[include external/tradrack_optional.cfg]



####################################################################
#   ADXL
####################################################################

#[include printerfiles/adxl.cfg]


####################################################################
#   MCUs
####################################################################

[mcu] 
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_16001F001151313236343430-if00
restart_method: command

[mcu rpi]
serial: /tmp/klipper_host_mcu

####################################################################
#   PRINTER
####################################################################

[printer]
kinematics: cartesian
max_velocity: 800
max_accel: 10000
max_z_velocity: 10
max_z_accel: 100
square_corner_velocity: 8.0

####################################################################
#   Probing
####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_24823969515137474C202020FF0D2342-if00
x_offset: -21.5
y_offset: 0
mesh_main_direction: x 
mesh_runs: 2
#backlash_comp: 2.015

[homing_override]
axes: xyz
gcode:
  {% set home_all = 'X' not in params and 'Y' not in params and 'Z' not in params %}

  {% if home_all or 'X' in params %}
    _HOME_X
  {% endif %}
  
  {% if home_all or 'Y' in params %}
    _HOME_Y
  {% endif %}
  
  {% if home_all or 'Z' in params %}
    SET_KINEMATIC_POSITION Z=10
    G90
    G1 X90 Y90 F15000
    G28 Z
    G1 Z10
  {% endif %}

[z_tilt]
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right
points:
    43.5, 25          # Front Left
    99.5, 130        # Rear
    173.5, 25         # Front Right
speed: 300
horizontal_move_z: 15.0
retries: 4
retry_tolerance: 0.006

[gcode_macro Z_TILT_ADJUST]
rename_existing: _Z_TILT_ADJUST
gcode:
    _z_tilt_adjust RETRY_TOLERANCE=1
    _z_tilt_adjust HORIZONTAL_MOVE_Z=2
    G28 Z

[bed_mesh]
mesh_min: 20,20
mesh_max: 158,150
algorithm: bicubic
horizontal_move_z: 3
probe_count: 14,14
speed: 250
mesh_pps: 0,0

####################################################################
#   AutoTune
####################################################################

[autotune_tmc stepper_x]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 36
sgt: 0

[autotune_tmc stepper_y]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 36
sgt: -2

[autotune_tmc stepper_x1]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 36
sgt:0

[autotune_tmc stepper_y1]
motor: ldo-42sth48-2004mah
tuning_goal: auto
voltage: 36
sgt:-2

[autotune_tmc stepper_z]
motor: ldo-42sth48-2504ah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z1]
motor: ldo-42sth48-2504ah
tuning_goal: auto
voltage: 24

[autotune_tmc stepper_z2]
motor: ldo-42sth48-2504ah
tuning_goal: auto
voltage: 24

[autotune_tmc extruder]
motor: ldo-36sth20-1004ahg
tuning_goal: performance
voltage: 24

###################################################################
#   InputShaper
###################################################################

[input_shaper]
#shaper_freq_x: 95.4
#shaper_type_x: mzv
smoother_freq_x: 94.8
shaper_type_x: smooth_mzv
#damping_ratio_x: 0.0688

#shaper_freq_y: 96.4
#shaper_type_y: mzv
smoother_freq_y: 92.6
shaper_type_y: smooth_mzv
#damping_ratio_y: 0.0593
enabled_extruders: extruder

####################################################################

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 22.780
#*# pid_ki = 1.215
#*# pid_kd = 106.779
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 42.381
#*# pid_ki = 1.228
#*# pid_kd = 365.535
#*#
#*# [beacon model default]
#*# model_coef = 1.6320188430604232,
#*# 	  1.77869127606186,
#*# 	  0.7507554148570488,
#*# 	  0.525423133254053,
#*# 	  0.2129205869362673,
#*# 	  -0.43024860898936107,
#*# 	  0.13024952952455168,
#*# 	  0.5614864047050887,
#*# 	  -0.13157395022785678,
#*# 	  -0.027149184203688895
#*# model_domain = 3.231537149417749e-07,3.344098204560401e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 32.477494
#*# model_offset = 0.02500
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.008641, -0.004933, -0.001992, 0.010870, 0.012406, 0.003776, -0.007740, -0.016934, -0.014752, -0.007635, -0.006441, -0.005343, -0.009419, -0.015698
#*# 	  -0.012952, -0.009756, -0.008354, 0.000825, 0.005091, -0.001944, -0.013468, -0.019699, -0.022760, -0.016097, -0.013763, -0.012262, -0.014112, -0.027875
#*# 	  -0.024133, -0.021812, -0.016975, -0.007416, -0.003879, -0.011673, -0.024473, -0.031942, -0.033760, -0.023311, -0.020336, -0.023165, -0.027773, -0.039346
#*# 	  -0.026408, -0.027012, -0.022275, -0.011308, -0.008090, -0.015655, -0.026133, -0.034950, -0.036765, -0.029821, -0.025985, -0.027849, -0.037256, -0.043363
#*# 	  -0.025376, -0.023125, -0.021556, -0.009550, -0.004426, -0.012906, -0.022462, -0.034195, -0.037621, -0.028197, -0.023995, -0.027818, -0.037874, -0.040295
#*# 	  -0.023456, -0.026516, -0.018768, -0.007248, -0.003444, -0.010631, -0.020775, -0.035662, -0.033854, -0.022779, -0.018600, -0.021869, -0.030152, -0.033091
#*# 	  -0.022820, -0.020913, -0.016028, -0.005550, 0.000270, -0.007414, -0.014980, -0.030000, -0.023512, -0.016020, -0.013707, -0.016876, -0.021825, -0.025175
#*# 	  -0.011288, -0.008989, -0.005056, 0.004840, 0.007838, -0.000163, -0.008073, -0.014112, -0.010732, -0.003907, -0.001963, -0.002428, -0.005100, -0.012468
#*# 	  -0.008932, -0.005474, -0.000628, 0.009864, 0.012901, 0.004537, -0.002831, -0.007551, -0.005329, 0.001494, 0.006037, 0.006977, 0.007339, 0.005696
#*# 	  -0.011350, -0.009529, -0.003579, 0.005659, 0.007954, 0.002606, -0.003262, -0.006617, -0.002131, 0.002303, 0.006083, 0.012454, 0.015598, 0.014285
#*# 	  -0.019487, -0.013724, -0.006936, 0.001550, 0.003842, -0.002486, -0.006020, -0.011764, -0.007341, -0.002540, -0.000411, 0.003969, 0.006216, 0.004011
#*# 	  -0.026141, -0.020424, -0.016336, -0.009878, -0.005499, -0.010301, -0.012790, -0.019568, -0.014743, -0.010098, -0.007101, -0.008562, -0.008442, -0.012767
#*# 	  -0.024229, -0.014720, -0.010350, -0.002115, 0.003183, -0.000500, -0.007389, -0.010226, -0.008004, -0.003072, -0.002092, -0.004616, -0.007270, -0.010950
#*# 	  -0.010415, -0.005208, 0.003359, 0.013543, 0.018945, 0.014816, 0.011093, 0.003959, 0.007358, 0.008723, 0.009348, 0.004501, 0.002012, -0.004941
#*# x_count = 14
#*# y_count = 14
#*# mesh_x_pps = 0
#*# mesh_y_pps = 0
#*# algo = direct
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 158.0
#*# min_y = 20.0
#*# max_y = 150.0